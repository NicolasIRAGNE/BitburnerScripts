<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>lib/testing.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Batch.html">Batch</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="ExecutionPolicy.html">ExecutionPolicy</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Host.html">Host</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Host.html#repr">repr</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Node.html">Node</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Node.html#fill">fill</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Node.html#matchesPolicy">matchesPolicy</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Node.html#run">run</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Node.html#satisfaction">satisfaction</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Task.html">Task</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="WorkloadManager.html">WorkloadManager</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="WorkloadManager.html#add_node">add_node</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="WorkloadManager.html#assign">assign</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="WorkloadManager.html#fill">fill</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="WorkloadManager.html#map">map</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="WorkloadManager.html#summary">summary</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="WorkloadManager.html#update">update</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="WorkloadManager.html#update_network">update_network</a></span></li><li class="nav-heading"><a href="global.html">Globals</a></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#expect_eq">expect_eq</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#generate_batch">generate_batch</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#recurse_scan">recurse_scan</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#recurse_scan_legacy">recurse_scan_legacy</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">lib/testing.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @fileOverview Provides some basic testing functionality.
 */

let _ns = null;

const sigma = 0.0000001;

export function init(ns)
{
    _ns = ns;
    // _testSuites = [];
}

export class ExecutionContext
{
    constructor(depth = 0)
    {
        let context = new Error().stack;
        this.function = context.split("\n")[2 + depth].split(" ")[5];
        this.file = context.split("\n")[2 + depth].split("/")[3].split(":")[0];
        this.line = context.split("\n")[2 + depth].split("/")[3].split(":")[1];
    }
}

class TestSuite
{
    constructor()
    {
        this.passed = 0;
        this.failed = 0;
        this.skipped = 0; // unimplemented at the moment
        this.time = -1; // unimplemented at the moment
        this.tests = [];
    }

    /**
     * Returns a string representation of the test results in the form:
     * [STATE] name (PASSED/TOTAL)
     * STATE is one of:
     * - PASS
     * - FAIL
     * @param {number} depth - The number of spaces to indent the output.
     */
    report(depth = 0)
    {
        let state = "UNKN";
        if (this.passed > 0)
        {
            state = "PASS";
        }
        if (this.failed > 0)
        {
            state = "FAIL";
        }
        let str = "";
        for (let i = 0; i &lt; depth; i++)
        {
            str += " ";
        }
        let total = this.passed + this.failed;
        str += `[${state}] ${this.name} (${this.passed}/${total})`;
        for (let test of this.tests)
        {
            str += "\n" + test.report(depth + 2);
        }
        return str;
    }
}

let _testSuites = [];

function addTestResult(executionContext, result)
{
    let s = _testSuites.find(s => s.name === executionContext.file);
    if (!s)
    {
        s = new TestSuite();
        s.name = executionContext.file;
        _testSuites.push(s);
    }
    let child = s.tests.find(t => t.name === executionContext.function);
    if (!child)
    {
        child = new TestSuite();
        child.name = executionContext.function;
        s.tests.push(child);
    }
    if (result === true)
    {
        child.passed++;
        s.passed++;
    }
    else
    {
        child.failed++;
        s.failed++;
    }
}

export function printReport()
{
    let str = "";
    for (let s of _testSuites)
    {
        str += s.report() + "\n";
    }
    _ns.tprint("\n" + str);
}

function fmt(executionContext, str)
{
    // `\n\t${executionContext.function}:\n\t\tExpected inequality of these two values:\n\t\t\t${a}\n\t\t\t${b}`
    return `\n\t${executionContext.file}:${executionContext.line} ${executionContext.function}:\n\t\t${str}`;
}

/**
 * Expects equality between two values.
 * @param {*} a 
 * @param {*} b 
 */
export function expect_eq(a, b)
{
    let executionContext = new ExecutionContext(1);
    if (a != b)
    {
        _ns.tprint(fmt(executionContext, `Expected equality of these two values:\n\t\t\t${a}\n\t\t\t${b}`));
    }
    addTestResult(executionContext, a == b);
}

export function expect_neq(a, b)
{
    let executionContext = new ExecutionContext(1);
    if (a == b)
    {
        _ns.tprint(fmt(executionContext, `Expected inequality of these two values:\n\t\t\t${a}\n\t\t\t${b}`));
    }
    addTestResult(executionContext, a != b);
}

export function expect_gt(a, b)
{
    let executionContext = new ExecutionContext(1);
    if (a &lt;= b)
    {
        _ns.tprint(fmt(executionContext, `Expected a > b:\n\t\t\t${a}\n\t\t\t${b}`));
    }
    addTestResult(executionContext, a > b);
}

export function expect_gte(a, b)
{
    let executionContext = new ExecutionContext(1);
    if (a &lt; b)
    {
        _ns.tprint(fmt(executionContext, `Expected a >= b:\n\t\t\t${a}\n\t\t\t${b}`));
    }
    addTestResult(executionContext, a >= b);
}

export function expect_lt(a, b)
{
    let executionContext = new ExecutionContext(1);
    if (a >= b)
    {
        _ns.tprint(fmt(executionContext, `Expected a &lt; b:\n\t\t\t${a}\n\t\t\t${b}`));
    }
    addTestResult(executionContext, a &lt; b);
}

export function expect_lte(a, b)
{
    let executionContext = new ExecutionContext(1);
    if (a > b)
    {
        _ns.tprint(fmt(executionContext, `Expected a &lt;= b:\n\t\t\t${a}\n\t\t\t${b}`));
    }
    addTestResult(executionContext, a &lt;= b);
}

export function expect_true(a)
{
    let executionContext = new ExecutionContext(1);
    if (a !== true)
    {
        _ns.tprint(fmt(executionContext, `Expected true:\n\t\t\t${a}`));
    }
    addTestResult(executionContext, a === true);
}

export function expect_false(a)
{
    let executionContext = new ExecutionContext(1);
    if (a !== false)
    {
        _ns.tprint(fmt(executionContext, `Expected false:\n\t\t\t${a}`));
    }
    addTestResult(executionContext, a === false);
}

export function expect_null(a)
{
    let executionContext = new ExecutionContext(1);
    if (a !== null)
    {
        _ns.tprint(fmt(executionContext, `Expected null:\n\t\t\t${a}`));
    }
    addTestResult(executionContext, a === null);
}

export function expect_throw(f, ...args)
{
    let executionContext = new ExecutionContext(1);
    try
    {
        f(...args);
    }
    catch (e)
    {
        addTestResult(executionContext, true);
        return;
    }
    _ns.tprint(fmt(executionContext, `Expected throw:\n\t\t\t${f.name}(${args.join(", ")})`));
    addTestResult(executionContext, false);
}

export function expect_nothrow(f, ...args)
{
    let executionContext = new ExecutionContext(1);
    try
    {
        f(...args);
    }
    catch (e)
    {
        _ns.tprint(fmt(executionContext, `Expected no throw:\n\t\t\t${f.name}(${args.join(", ")})`));
        addTestResult(executionContext, false);
        return;
    }
    addTestResult(executionContext, true);
}

export function expect_type(a, type)
{
    let executionContext = new ExecutionContext(1);
    if (typeof a !== type)
    {
        _ns.tprint(fmt(executionContext, `Expected type:\n\t\t\t${type}\n\t\t\t${a}`));
    }
    addTestResult(executionContext, typeof a === type);
}

export function expect_instanceof(a, type)
{
    let executionContext = new ExecutionContext(1);
    if (!(a instanceof type))
    {
        _ns.tprint(fmt(executionContext, `Expected instanceof:\n\t\t\t${type}\n\t\t\t${a}`));
    }
    addTestResult(executionContext, a instanceof type);
}

export function expect_float_eq(a, b)
{
    let executionContext = new ExecutionContext(1);
    if (Math.abs(a - b) > sigma)
    {
        _ns.tprint(fmt(executionContext, `Expected equality of these two values:\n\t\t\t${a}\n\t\t\t${b}`));
    }
    addTestResult(executionContext, Math.abs(a - b) &lt; sigma);
}

export function expect_float_neq(a, b)
{
    let executionContext = new ExecutionContext(1);
    if (Math.abs(a - b) &lt; sigma)
    {
        _ns.tprint(fmt(executionContext, `Expected inequality of these two values:\n\t\t\t${a}\n\t\t\t${b}`));
    }
    addTestResult(executionContext, Math.abs(a - b) > sigma);
}</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.7</a> on Fri Aug 05 2022 20:51:19 GMT+0000 (Coordinated Universal Time) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
